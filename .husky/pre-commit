#!/bin/sh
set -e

echo "ğŸ” Executando pre-commit hook..."

STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(js|ts|jsx|tsx)$' || true)
if [ -z "$STAGED_FILES" ]; then
  echo "âš ï¸ Nenhum arquivo relevante para lint encontrado. Pulando lint..."
  exit 0
fi

echo "ğŸ§¹ Rodando ESLint nos arquivos staged..."
npx eslint $STAGED_FILES || {
  echo "âŒ ESLint falhou. Corrija os erros antes de commitar."
  exit 1
}

echo "ğŸ§ª Rodando testes..."
npx jest --bail --findRelatedTests --passWithNoTests $STAGED_FILES || {
  echo "âŒ Alguns testes falharam. Corrija-os antes de commitar."
  exit 1
}

echo "ğŸ¨ Rodando Prettier..."
npx prettier --check $STAGED_FILES || {
  echo "âŒ Prettier encontrou arquivos mal formatados. Rode 'npx prettier --write .'"
  exit 1
}

echo "âœ… Pre-commit passou com sucesso!"
exit 0
